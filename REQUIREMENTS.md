# 要件定義書 (Requirements Definition)

## 1. システム概要
本システム「MailConsolidator」は、複数のメールアカウント（POP3/IMAP）からメールを取得し、単一のIMAPサーバへ集約・転送するデスクトップアプリケーションである。

## 2. 機能要件

### 2.1 メール集約機能
- **複数ソース対応**: 複数の取得元メールサーバ（POP3およびIMAP）を設定可能とする。
- **転送先設定**: 単一の転送先IMAPサーバを設定可能とする。
- **プロトコル対応**:
  - 取得元: POP3 (SSL), IMAP (SSL)
  - 転送先: IMAP (SSL)
- **メール取得ロジック**:
  - **IMAP**: 「未読」メールのみを取得対象とする。
  - **POP3**: 新着メールを取得対象とする（サーバ仕様に依存）。

### 2.2 メール処理・保持ポリシー
- **移動後に削除 (Delete after move)**:
  - 設定により、転送成功後に取得元サーバからメールを削除可能とする（POP3推奨）。
  - 削除しない設定の場合（IMAP推奨）、取得元サーバで「既読」マークを付与し、次回取得対象外とする。
  - 削除しない設定の場合、GUIのステータスモニターには「完了（保持）」として履歴を残す。

### 2.3 ユーザーインターフェース (GUI)
- **設定画面**:
  - 転送先サーバの設定（ホスト、ポート、ユーザー、パスワード、フォルダ）。
  - 取得元サーバの追加・編集・削除。
  - **設定更新**: 既存の取得元設定を選択して内容を更新できること（リスト選択状態の維持）。
- **実行パネル**:
  - **手動実行**: 「今すぐ実行」ボタンにより、即座に集約処理を実行可能とする。
  - **定期実行**:
    - 指定した間隔（分）でバックグラウンドで集約処理を実行可能とする。
    - 「定期実行を開始/停止」ボタンにより、処理のON/OFFを切り替え可能とする。
    - 実行中はボタン名を「定期実行を停止」に変更し、停止操作を受け付けること。
    - 停止処理中は「停止処理中...」等のフィードバックを表示すること。
  - **ステータスモニター**:
    - 処理中のメール（送信者、件名、日時、ステータス）をリアルタイムで一覧表示する。

### 2.4 セキュリティ
- **通信暗号化**: すべてのメールサーバ通信においてSSL/TLSをサポートする。
- **パスワード管理**:
  - 設定ファイル (`config.yaml`) 内のパスワードは暗号化して保存する。
  - Gmail等のアプリパスワードに対応する（OAuth 2.0は非採用）。

## 3. 非機能要件

### 3.1 操作性・応答性
- **バックグラウンド実行**: 定期実行および手動実行はメインスレッド（UIスレッド）とは別のスレッドで実行し、GUIのフリーズ（「応答なし」）を防止する。
- **フィードバック**: 処理の開始・終了・エラー発生時に適切なメッセージまたはログを表示する。

### 3.2 信頼性
- **データ保全**: 転送先への保存が完了したことを確認してから、取得元の削除または既読化を行う（メール消失の防止）。
- **エラーハンドリング**: ネットワークエラーや認証エラーが発生してもアプリケーションがクラッシュせず、エラーログを記録して次回の実行に備える。

### 3.3 環境
- **OS**: Windows (主なターゲット)
- **言語**: Python 3.x
- **ライブラリ**: Tkinter (GUI), imaplib, poplib, PyYAML
